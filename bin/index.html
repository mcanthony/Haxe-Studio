<!DOCTYPE html>
<html>
	<head>
		<title>Haxe Studio</title>
		<meta charset="utf-8">
		<script>tsort = require('gaia-tsort');</script>
		
		
		<script src="./js/jquery-2.0.3.min.js"></script>
		<script src="./js/jquery.keystroke.min.js"></script>
		<script src="./js/bootstrap/bootstrap.min.js"></script>	
		<script src="./js/bootstrap/bootstrap-select.min.js"></script>
		<script src="./js/bootstrap/bootstrap-notify.js"></script>	
		<link href="./css/bootstrap-select.min.css" rel="stylesheet" media="screen">		
		
		<script src="./js/node.dir.walker.js"></script>
		<script src="./js/cputime.js"></script>		
		<script src="./js/EventBus.js"></script>
		
		<link href="./css/bootstrap.min.css" rel="stylesheet" media="screen">
		<link href="./css/bootstrap-glyphicons.css" rel="stylesheet" media="screen">
		<link href="./css/bootstrap-notify.css" rel="stylesheet" media="screen">
		
		<script>
		localStorage.clear();
		$("body").on("plugin_loaded",function()
		{
		console.log("loaded");
		});
		
		gui = require("nw.gui");
		
		setInterval(function()
			{
			localStorage.event_listeners = JSON.stringify(Main.message.listen_message);
			localStorage.event_dispatchers = JSON.stringify(Main.message.broadcast_message);
			},5000);
		</script>
		
	</head>
	<body>
		<div id="haxe:trace"></div>
		<div style="overflow:auto;" class="modal fade" id="splash" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
			<div class="modal-content">
		
			  <div class="modal-header">
			  	<div class="text-center">
					<h3>Haxe Studio</h3>
					<p>version <span id="haxestudio_version"></span></p>
				</div>
			  </div>    
		
			  <div class="modal-body">
			  	<div class="col-xs-6">
				  	<button type="button" class="btn btn-default btn-lg btn-block"><span class="glyphicon glyphicon-file"></span>&nbsp;&nbsp;New Project</button>
			  	</div>
			  	<div class="col-xs-6">
				  	<button type="button" onClick="Main.message.broadcast('core:FileMenu.openProject','splash',null);" class="btn btn-primary btn-lg btn-block"><span class="glyphicon glyphicon-folder-open"></span>&nbsp;&nbsp;Open Project</button>
			  	</div>
			  	<p><br/></p>
			  </div>
			  <div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			  </div>
			</div>
		  </div>
		</div>	
	
	
		<div style="z-index:9999" class='notifications bottom-right'></div>
		<div id='editor_position' ></div>
		<div id='temp' style='display:none'></div>		
	</body>
	
			<link href="./css/index.css" rel="stylesheet" media="screen">
			<link href="./theme/theme.css" rel="stylesheet" media="screen">
			<script src="./js/menu.js"></script>
			<script src="./js/haxestudio.js"></script>
			<script src="./js/error_code.js"></script>
			<script src="./js/defaultMenu.js"></script>
			<script>
				function toggleSplash()
					{
					if ($('#splash').css("display") != "block")
						{
						$('#splash').modal({show:true,keyboard:false,backdrop:false});
						$("#haxestudio_version").html(Main.version);	
						}				
					else
						{
						$('#splash').css("display","none");
						$('#splash').modal({show:false});
						}
					}
					
				function notify(message,type)
					{
					if (Main.error_code[message] != null)
						{
						message = Main.error_code[message];
						}
					
					var closable =true;
					var fadeout = { enabled: true, delay: 3000 }
					var glyphicon = '';
					if (type=="danger")
						{
						closable = false;
						fadeout ={ enabled: true, delay: 10000 }
						glyphicon = '<span class="glyphicon glyphicon-warning-sign"></span>'
						}

					if (type=="info")
						{
						closable = true;
						fadeout ={ enabled: true, delay: 3000 }
						glyphicon = '<span class="glyphicon glyphicon-info-sign"></span>'
						}
						
					
					$('.bottom-right').notify({
						message: { text: message},
						type :type, // info,success,warning,danger,inverse,blackgloss
						closable:closable,
						fadeOut:fadeout,
						glyphicon:glyphicon
						}).show(); // for the ones that aren't closable and don't fade out there is a .hide() function.
					}
					
				function reload_haxestudio()
					{
					gui.Window.get().reload();
					}
					
								
				$(document).ready(function()
					{
					Main.message.listen("plugin.misterpah.ProjectAccess:system_parse_project.complete","splash",function(){toggleSplash();});
					Main.message.listen("plugin.misterpah.FileAccess:open_file.complete","splash",function(){toggleSplash();});
					toggleSplash();
					});

				// prevent drag & drop
				document.body.addEventListener('dragover', function(e){
				  e.preventDefault();
				  e.stopPropagation();
				}, false);
				
				function recompile_all_plugin()
					{
					var dirname = process.execPath.substr(0,process.execPath.lastIndexOf('/'));
					var plugin_path = dirname+"/../../plugin/";
					
					
					var plugin_list = Utils.readDir("../plugin");
					for (var i=0;i<plugin_list.length;i++)
						{
						Utils.exec(["cd %CD% "+plugin_path+plugin_list[i]+"/source","haxe build.hxml"],function(p1,p2,p3)
							{
							if (p3 != "")
								{
								notify(p3,"danger");
								console.dir(p3);
								console.log("--------------");
								}
							else
								{
								notify("compile ok!","success");								
								console.log("ok");
								}
							});
						}
					var core_path = dirname+"/../../source";
						Utils.exec(["cd %CD% "+core_path,"haxe build.hxml"],function(p1,p2,p3)
							{
							if (p3 != "")
								{
								notify(p3,"danger");								
								console.dir(p3);
								console.log("--------------");
								}
							else
								{
								notify("core compile ok!","success");
								console.log("core ok");
								}
							});
					
					
					
					}
			</script>	
	
</html>

